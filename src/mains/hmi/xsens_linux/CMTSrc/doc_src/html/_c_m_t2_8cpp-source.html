<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>CMT: CMT2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<div class="logo">
    <img src="LogoXsensMotion.gif" alt="Xsens Logo" style="float: right;" />
</div>

<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li id="current"><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<div class="tabs">
  <ul>
    <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
  </ul></div>
<h1>CMT2.cpp</h1><a href="_c_m_t2_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00025"></a>00025 <span class="preprocessor">#include "<a class="code" href="_c_m_t2_8h.html">cmt2.h</a>"</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keyword">namespace </span>xsens {
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 <span class="preprocessor">#ifdef _LOG_CMT2</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#       define CMT2LOG          CMTLOG</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00032"></a><a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">00032</a> <span class="preprocessor"></span><span class="preprocessor">#       define CMT2LOG(...)</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00036"></a><a class="code" href="namespacexsens.html#4afd105a52b808febde0c645742b1d0d">00036</a> int32_t <a class="code" href="namespacexsens.html#4afd105a52b808febde0c645742b1d0d">findValidMessage</a>(<span class="keyword">const</span> uint8_t* buffer, <span class="keyword">const</span> uint16_t bufferLength)
<a name="l00037"></a>00037 {
<a name="l00038"></a>00038         <a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>* hdr = NULL;
<a name="l00039"></a>00039         uint16_t pre = 0;
<a name="l00040"></a>00040         uint16_t target;
<a name="l00041"></a>00041         <span class="keywordtype">bool</span> extended;
<a name="l00042"></a>00042         uint16_t length;
<a name="l00043"></a>00043         int32_t res;
<a name="l00044"></a>00044         <a class="code" href="classxsens_1_1_message.html">Message</a>* msg;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="comment">// find the preamble</span>
<a name="l00047"></a>00047         <span class="keywordflow">while</span>(pre &lt; bufferLength &amp;&amp; (buffer[pre] != <a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>))
<a name="l00048"></a>00048                 ++pre;
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         <span class="keywordflow">if</span> (pre &gt;= bufferLength)
<a name="l00051"></a>00051                 <span class="keywordflow">return</span> -1;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053         <span class="comment">// check if the message is valid</span>
<a name="l00054"></a>00054         length = bufferLength-pre;
<a name="l00055"></a>00055         <span class="keywordflow">if</span> (length &lt; <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>)
<a name="l00056"></a>00056                 <span class="keywordflow">return</span> -1;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058         <span class="comment">// parse header</span>
<a name="l00059"></a>00059         
<a name="l00060"></a>00060         hdr = (<a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>*) (buffer + pre);
<a name="l00061"></a>00061         <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> == <a class="code" href="_c_m_tdef_8h.html#d973d7444627ebeb906205cacbcf6f3e">CMT_EXTLENCODE</a>)
<a name="l00062"></a>00062         {
<a name="l00063"></a>00063                 extended = <span class="keyword">true</span>;
<a name="l00064"></a>00064                 <span class="keywordflow">if</span> (length &lt; <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>)
<a name="l00065"></a>00065                         <span class="keywordflow">return</span> -1;
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <span class="keywordflow">else</span>
<a name="l00068"></a>00068                 extended = <span class="keyword">false</span>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         <span class="comment">// check the reported size</span>
<a name="l00071"></a>00071         target = extended?
<a name="l00072"></a>00072                                 ((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>)
<a name="l00073"></a>00073                                 + <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>:
<a name="l00074"></a>00074                                 (uint16_t) (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a>) + <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>;
<a name="l00075"></a>00075         <span class="keywordflow">if</span> (target &lt;= length)
<a name="l00076"></a>00076         {
<a name="l00077"></a>00077                 <span class="comment">// header seems to be ok, check checksum</span>
<a name="l00078"></a>00078                 <span class="comment">// check the checksum</span>
<a name="l00079"></a>00079 
<a name="l00080"></a>00080                 msg=<span class="keyword">new</span> <a class="code" href="classxsens_1_1_message.html">Message</a>(buffer+pre,(uint16_t) target,(uint16_t) target);
<a name="l00081"></a>00081                 <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classxsens_1_1_message.html#0dd5d745c647d32a9a9babf4c5d33dcd">isChecksumOk</a>())
<a name="l00082"></a>00082                 {
<a name="l00083"></a>00083                         <span class="keyword">delete</span> msg;
<a name="l00084"></a>00084                         <span class="keywordflow">return</span> (int32_t) pre;
<a name="l00085"></a>00085                 }
<a name="l00086"></a>00086                 <span class="keyword">delete</span> msg;
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="comment">// try next message</span>
<a name="l00090"></a>00090         res = <a class="code" href="namespacexsens.html#4afd105a52b808febde0c645742b1d0d">findValidMessage</a>(buffer+pre+1,length-1);
<a name="l00091"></a>00091         <span class="keywordflow">if</span> (res == -1)
<a name="l00092"></a>00092                 <span class="keywordflow">return</span> -1;
<a name="l00093"></a>00093         <span class="keywordflow">return</span> res + pre + 1;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00099"></a>00099 
<a name="l00101"></a>00101 <span class="comment">// Default constructor, initializes all members to their default values.</span>
<a name="l00102"></a><a class="code" href="classxsens_1_1_cmt2s.html#19fd7f1bdcc307b7ef285f0f97be621b">00102</a> <a class="code" href="classxsens_1_1_cmt2s.html#19fd7f1bdcc307b7ef285f0f97be621b">Cmt2s::Cmt2s</a>() :
<a name="l00103"></a>00103         m_onMessageReceived(NULL),
<a name="l00104"></a>00104         m_onMessageSent(NULL)
<a name="l00105"></a>00105 {
<a name="l00106"></a>00106         <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00107"></a>00107         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> = 0;
<a name="l00108"></a>00108         <a class="code" href="classxsens_1_1_cmt2s.html#3068c5bc4fd712faef8e219633388943">m_timeout</a> = <a class="code" href="_c_m_tdef_8h.html#ab875c2b217956722317f1ebbde6c920">CMT2_DEFAULT_TIMEOUT</a>;
<a name="l00109"></a>00109         <a class="code" href="classxsens_1_1_cmt2s.html#2ad06dcfe1a3807ec8456cc88f64750b">m_baudrate</a> = <a class="code" href="_c_m_tdef_8h.html#56b1b182fb05cb2746c0a29ab5bae7ed">CMT_DEFAULT_BAUD_RATE</a>;
<a name="l00110"></a>00110         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 0;
<a name="l00111"></a>00111 }
<a name="l00112"></a>00112 
<a name="l00114"></a>00114 <span class="comment">// Destructor, de-initializes, frees memory allocated for buffers, etc.</span>
<a name="l00115"></a><a class="code" href="classxsens_1_1_cmt2s.html#2a67c3108870c0ed61fde78ffce17841">00115</a> <a class="code" href="classxsens_1_1_cmt2s.html#2a67c3108870c0ed61fde78ffce17841">Cmt2s::~Cmt2s</a>()
<a name="l00116"></a>00116 {
<a name="l00117"></a>00117 }
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a><a class="code" href="classxsens_1_1_cmt2s.html#6c1d8935ef7ac15be3f5cd6b3801ebad">00120</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#6c1d8935ef7ac15be3f5cd6b3801ebad">Cmt2s::close</a>(<span class="keywordtype">void</span>)
<a name="l00121"></a>00121 {
<a name="l00122"></a>00122         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>())
<a name="l00123"></a>00123         {
<a name="l00124"></a>00124                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Closing port %d\n"</span>,(int32_t)<a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>());
<a name="l00125"></a>00125                 <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 0;
<a name="l00126"></a>00126                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#29d64fe8e43430225b02450cac4a65eb">close</a>();
<a name="l00127"></a>00127         }
<a name="l00128"></a>00128         <span class="keywordflow">else</span>
<a name="l00129"></a>00129                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f286030c8ef758b70a66bed69f0e43e70">XRV_NOPORTOPEN</a>;
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
<a name="l00133"></a>00133 <span class="comment">// Retrieve the port that the object is connected to.</span>
<a name="l00134"></a><a class="code" href="classxsens_1_1_cmt2s.html#cec7fe49e5273911f8abc81abd22e9bd">00134</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#cec7fe49e5273911f8abc81abd22e9bd">Cmt2s::getPortName</a>(<span class="keywordtype">char</span> *portname)<span class="keyword"> const</span>
<a name="l00135"></a>00135 <span class="keyword"></span>{
<a name="l00136"></a>00136         <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#047ed451689538e7e2e99f248b094a6f">getPortName</a>(portname);
<a name="l00137"></a>00137         <span class="comment">// we know there should be at least "/dev/x"</span>
<a name="l00138"></a>00138         <span class="keywordflow">if</span> (strlen(portname) &lt; 6)
<a name="l00139"></a>00139                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>;
<a name="l00140"></a>00140         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00144"></a>00144 <span class="comment">// Retrieve the port that the object is connected to.</span>
<a name="l00145"></a><a class="code" href="classxsens_1_1_cmt2s.html#16c0872d8785745fc8a4a648fd7a3c4a">00145</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#16c0872d8785745fc8a4a648fd7a3c4a">Cmt2s::getPortNr</a>(uint16_t&amp; port)<span class="keyword"> const</span>
<a name="l00146"></a>00146 <span class="keyword"></span>{
<a name="l00147"></a>00147         port = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>();
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (port == 0)
<a name="l00149"></a>00149                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>;
<a name="l00150"></a>00150         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00151"></a>00151 }
<a name="l00152"></a>00152 
<a name="l00154"></a>00154 <span class="comment">// Retrieve the port that the object is connected to.</span>
<a name="l00155"></a><a class="code" href="classxsens_1_1_cmt2s.html#412a71d1ca8edbfa8d32e91e90960dbb">00155</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#16c0872d8785745fc8a4a648fd7a3c4a">Cmt2s::getPortNr</a>(int32_t&amp; port)<span class="keyword"> const</span>
<a name="l00156"></a>00156 <span class="keyword"></span>{
<a name="l00157"></a>00157         port = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>();
<a name="l00158"></a>00158         <span class="keywordflow">if</span> (port == 0)
<a name="l00159"></a>00159                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>;
<a name="l00160"></a>00160         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00161"></a>00161 }
<a name="l00162"></a>00162 
<a name="l00164"></a>00164 <span class="comment">// Open a communication channel to the given serial port name.</span>
<a name="l00165"></a><a class="code" href="classxsens_1_1_cmt2s.html#ccafa10d5a79134762573a45262b98ec">00165</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#ccafa10d5a79134762573a45262b98ec">Cmt2s::open</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> *portName, <span class="keyword">const</span> uint32_t baudRate)
<a name="l00166"></a>00166 {
<a name="l00167"></a>00167         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Opening port %s @baud %d\n"</span>, portName, baudRate);
<a name="l00168"></a>00168         <a class="code" href="classxsens_1_1_cmt2s.html#2ad06dcfe1a3807ec8456cc88f64750b">m_baudrate</a> = baudRate;
<a name="l00169"></a>00169         <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#31c11cd69aba26459cbd57b5f55b4797">open</a>(portName, baudRate);
<a name="l00170"></a>00170         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 0;
<a name="l00171"></a>00171         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Port open result %d: %s\n"</span>, (int32_t) <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>, <a class="code" href="xsens__std_8h.html#7386853937f4c078e1458f2c34049ace">xsensResultText</a>(m_lastResult));
<a name="l00172"></a>00172         <span class="keywordflow">return</span> m_lastResult;
<a name="l00173"></a>00173 }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 <span class="preprocessor">#ifdef _WIN32</span>
<a name="l00177"></a>00177 <span class="preprocessor">// Open a communication channel to the given COM port number.</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span><a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#ccafa10d5a79134762573a45262b98ec">Cmt2s::open</a> (<span class="keyword">const</span> uint32_t portNumber, <span class="keyword">const</span> uint32_t baudRate)
<a name="l00179"></a>00179 {
<a name="l00180"></a>00180         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Opening port %d @baud %d\n"</span>,(int32_t)portNumber,baudRate);
<a name="l00181"></a>00181         <a class="code" href="classxsens_1_1_cmt2s.html#2ad06dcfe1a3807ec8456cc88f64750b">m_baudrate</a> = baudRate;
<a name="l00182"></a>00182         <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#31c11cd69aba26459cbd57b5f55b4797">open</a>(portNumber,baudRate);
<a name="l00183"></a>00183         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 0;
<a name="l00184"></a>00184         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Port open result %d: %s\n"</span>,(int32_t)<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>,<a class="code" href="xsens__std_8h.html#7386853937f4c078e1458f2c34049ace">xsensResultText</a>(m_lastResult));
<a name="l00185"></a>00185         <span class="keywordflow">return</span> m_lastResult;
<a name="l00186"></a>00186 }
<a name="l00187"></a>00187 <span class="preprocessor">#endif</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>
<a name="l00190"></a>00190 <span class="comment">// Read a message from the COM port.</span>
<a name="l00191"></a><a class="code" href="classxsens_1_1_cmt2s.html#8de6b3c4801b79c16c4ac73b86eb97b3">00191</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#8de6b3c4801b79c16c4ac73b86eb97b3">Cmt2s::readMessage</a>(<a class="code" href="classxsens_1_1_message.html">Message</a>* rcv)
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193         <a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>* hdr = (<a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>*) <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>;
<a name="l00194"></a>00194         uint16_t pre = 0;
<a name="l00195"></a>00195         uint32_t length = 0;
<a name="l00196"></a>00196         uint32_t target;
<a name="l00197"></a>00197         uint16_t i;
<a name="l00198"></a>00198         <span class="keywordtype">bool</span> extended;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage started, bufferCount=%u\n"</span>,<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> == 0)
<a name="l00203"></a>00203                 <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[0] = (uint8_t) ~<a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>;      <span class="comment">// create a value that is definitely NOT a preamble</span>
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#e839e2b84cd613ca5483c7c58b759d6f">CMT_MAXMSGLEN</a>)
<a name="l00206"></a>00206                 <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#2237eef35fbf249e18fa3e50474bf8ea">readData</a>(<a class="code" href="_c_m_tdef_8h.html#e839e2b84cd613ca5483c7c58b759d6f">CMT_MAXMSGLEN</a>-<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>+<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,&amp;length);
<a name="l00207"></a>00207         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> += (uint16_t) length;
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         <span class="keywordflow">while</span>(<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &gt; 0)
<a name="l00210"></a>00210         {
<a name="l00211"></a>00211                 <span class="keywordflow">while</span>(<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &gt; 0)
<a name="l00212"></a>00212                 {
<a name="l00213"></a>00213                         <span class="comment">// find preamble</span>
<a name="l00214"></a>00214                         <span class="keywordflow">while</span> ((pre &lt; <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>) &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[pre] != <a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>))
<a name="l00215"></a>00215                                 ++pre;
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                         <span class="keywordflow">if</span> (pre == <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>)
<a name="l00218"></a>00218                         {
<a name="l00219"></a>00219                                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage no preamble found in buffer\n"</span>);
<a name="l00220"></a>00220                                 <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> = 0;
<a name="l00221"></a>00221                                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00222"></a>00222                         }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage preamble found at position %u\n"</span>,(uint32_t) pre);
<a name="l00225"></a>00225                         <span class="comment">// shift buffer to start</span>
<a name="l00226"></a>00226                         <span class="keywordflow">if</span> (pre)
<a name="l00227"></a>00227                         {
<a name="l00228"></a>00228                                 <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> -= pre;
<a name="l00229"></a>00229                                 <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>;++i)
<a name="l00230"></a>00230                                         <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i] = <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i+pre];
<a name="l00231"></a>00231                         }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>)
<a name="l00234"></a>00234                         {
<a name="l00235"></a>00235                                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage not enough header data read\n"</span>);
<a name="l00236"></a>00236                                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                         <span class="comment">// read header</span>
<a name="l00240"></a>00240                         <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> == <a class="code" href="_c_m_tdef_8h.html#d973d7444627ebeb906205cacbcf6f3e">CMT_EXTLENCODE</a>)
<a name="l00241"></a>00241                         {
<a name="l00242"></a>00242                                 extended = <span class="keyword">true</span>;
<a name="l00243"></a>00243                                 if (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>)
<a name="l00244"></a>00244                                 {
<a name="l00245"></a>00245                                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage not enough extended header data read\n"</span>);
<a name="l00246"></a>00246                                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00247"></a>00247                                 }
<a name="l00248"></a>00248                         }
<a name="l00249"></a>00249                         <span class="keywordflow">else</span>
<a name="l00250"></a>00250                                 extended = <span class="keyword">false</span>;
<a name="l00251"></a>00251 
<a name="l00252"></a>00252                         <span class="comment">// check the reported size</span>
<a name="l00253"></a>00253                         target = (extended?((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>):(uint16_t) (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a>));
<a name="l00254"></a>00254                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage bytes in buffer=%u, extended=%u, target=%u\n"</span>,(uint32_t) <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,(uint32_t) extended, (uint32_t) target);
<a name="l00255"></a>00255                         <span class="keywordflow">if</span> ((uint32_t) target &gt; (uint32_t) <a class="code" href="_c_m_tdef_8h.html#b5b89ed4f29d3d51111ac9521dfd9809">CMT_MAXDATALEN</a>)
<a name="l00256"></a>00256                         {
<a name="l00257"></a>00257                                 <span class="comment">// skip current preamble</span>
<a name="l00258"></a>00258                                 pre = 1;
<a name="l00259"></a>00259                                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage invalid message length %u\n"</span>,(uint32_t) target);
<a name="l00260"></a>00260                                 <span class="keywordflow">continue</span>;
<a name="l00261"></a>00261                         }
<a name="l00262"></a>00262                         <span class="keywordflow">break</span>;  <span class="comment">// everything seems to be ok, get out of inner while() loop</span>
<a name="l00263"></a>00263                 }
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                 <span class="comment">// header seems to be ok, read until end and check checksum</span>
<a name="l00266"></a>00266                 <span class="keywordflow">if</span> (extended)
<a name="l00267"></a>00267                         target += <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>;
<a name="l00268"></a>00268                 <span class="keywordflow">else</span>
<a name="l00269"></a>00269                         target += <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>;
<a name="l00270"></a>00270 
<a name="l00271"></a>00271                 <span class="comment">// read the entire message</span>
<a name="l00272"></a>00272                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; target)
<a name="l00273"></a>00273                 {
<a name="l00274"></a>00274                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage readBufferCount %u &lt; target %u\n"</span>,(uint32_t) <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>, (uint32_t) target);
<a name="l00275"></a>00275                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00276"></a>00276                 }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278                 <span class="comment">// check the checksum</span>
<a name="l00279"></a>00279                 <span class="keywordflow">if</span> (rcv-&gt;<a class="code" href="classxsens_1_1_message.html#e31a715b5812028284e8fa4a87e987ab">loadFromString</a>(<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,(uint16_t) target) == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00280"></a>00280                 {
<a name="l00281"></a>00281                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage OK\n"</span>);
<a name="l00282"></a>00282                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#3f397fc880ea2c1c7e0c6cd5d5de111d">m_onMessageReceived</a> != NULL)
<a name="l00283"></a>00283                         {
<a name="l00284"></a>00284                                 <a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>* bytes = (<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>));
<a name="l00285"></a>00285                                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a> = target;
<a name="l00286"></a>00286                                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>();
<a name="l00287"></a>00287 <span class="comment">//                              bytes-&gt;m_type = CMT_CALLBACK_ONMESSAGERECEIVED;</span>
<a name="l00288"></a>00288                                 memcpy(bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#486cf709c2db8534c6e29234fc263d11">m_data</a>,<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,target);
<a name="l00289"></a>00289 <span class="preprocessor">#ifdef _LOG_CALLBACKS</span>
<a name="l00290"></a>00290 <span class="preprocessor"></span>                                <a class="code" href="_c_m_t1_8h.html#990d19ec2de73091adbb95d7057f21a2">CMTLOG</a>(<span class="stringliteral">"C2: m_onMessageReceived(%d,(%d,%d),%p)\n"</span>,(int32_t) <a class="code" href="classxsens_1_1_cmt2s.html#55d1a74bd3941f8f4e8244dd3330eaef">m_onMessageReceivedInstance</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a>, <a class="code" href="classxsens_1_1_cmt2s.html#53a76a499df2fe939163a911ac807c36">m_onMessageReceivedParam</a>);
<a name="l00291"></a>00291 <span class="preprocessor">#endif</span>
<a name="l00292"></a>00292 <span class="preprocessor"></span>                                <a class="code" href="classxsens_1_1_cmt2s.html#3f397fc880ea2c1c7e0c6cd5d5de111d">m_onMessageReceived</a>(m_onMessageReceivedInstance,<a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6bc19200e40f05c942aee06dcd5f45d0d2">CMT_CALLBACK_ONMESSAGERECEIVED</a>,bytes,<a class="code" href="classxsens_1_1_cmt2s.html#53a76a499df2fe939163a911ac807c36">m_onMessageReceivedParam</a>);
<a name="l00293"></a>00293                         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295                         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> -= (uint16_t) target;
<a name="l00296"></a>00296                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>)
<a name="l00297"></a>00297                                 <span class="keywordflow">for</span> (i=0;i&lt;m_readBufferCount;++i)
<a name="l00298"></a>00298                                         <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i] = <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i+target];
<a name="l00299"></a>00299 
<a name="l00300"></a>00300                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00301"></a>00301                 }
<a name="l00302"></a>00302                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage invalid checksum %02x %02x %02x %02x %02x\n"</span>,rcv-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[0]
<a name="l00303"></a>00303                                                                                                                                                         ,rcv-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[1]
<a name="l00304"></a>00304                                                                                                                                                         ,rcv-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[2]
<a name="l00305"></a>00305                                                                                                                                                         ,rcv-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[3]
<a name="l00306"></a>00306                                                                                                                                                         ,rcv-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[4]);
<a name="l00307"></a>00307                 <span class="comment">// skip current preamble</span>
<a name="l00308"></a>00308                 pre = 1;
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: readMessage timed out\n"</span>);
<a name="l00312"></a>00312         <span class="comment">// a timeout occurred</span>
<a name="l00313"></a>00313         <span class="keywordflow">return</span> m_lastResult = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315         
<a name="l00317"></a>00317 <span class="comment">// Set the callback function for when a message has been received or sent</span>
<a name="l00318"></a><a class="code" href="classxsens_1_1_cmt2s.html#0d10997afb92cef6a678d3c677697104">00318</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> Cmt2s::setCallbackFunction(<a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6b">CmtCallbackSelector</a> tp, int32_t instance, <a class="code" href="_c_m_tdef_8h.html#b8e2b27a4f48f3278e72be09b7c7b72c">CmtCallbackFunction</a> func, <span class="keywordtype">void</span>* param)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320         <span class="keywordflow">switch</span> (tp)
<a name="l00321"></a>00321         {
<a name="l00322"></a>00322         <span class="keywordflow">case</span> <a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6bc19200e40f05c942aee06dcd5f45d0d2">CMT_CALLBACK_ONMESSAGERECEIVED</a>:
<a name="l00323"></a>00323                 <a class="code" href="classxsens_1_1_cmt2s.html#3f397fc880ea2c1c7e0c6cd5d5de111d">m_onMessageReceived</a> = func;
<a name="l00324"></a>00324                 <a class="code" href="classxsens_1_1_cmt2s.html#55d1a74bd3941f8f4e8244dd3330eaef">m_onMessageReceivedInstance</a> = instance;
<a name="l00325"></a>00325                 <a class="code" href="classxsens_1_1_cmt2s.html#53a76a499df2fe939163a911ac807c36">m_onMessageReceivedParam</a> = param;
<a name="l00326"></a>00326                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00327"></a>00327         <span class="keywordflow">case</span> <a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6b4c20d96cde6cb06b75533c9ff3028afc">CMT_CALLBACK_ONMESSAGESENT</a>:
<a name="l00328"></a>00328                 <a class="code" href="classxsens_1_1_cmt2s.html#8f6fdf451d367d9f84b43b43ad654a71">m_onMessageSent</a> = func;
<a name="l00329"></a>00329                 <a class="code" href="classxsens_1_1_cmt2s.html#cadf278c15be513e435d8eb69777c4d8">m_onMessageSentInstance</a> = instance;
<a name="l00330"></a>00330                 <a class="code" href="classxsens_1_1_cmt2s.html#cbce34e1a0a099773bb41dd920ead345">m_onMessageSentParam</a> = param;
<a name="l00331"></a>00331                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00332"></a>00332         <span class="keywordflow">default</span>:
<a name="l00333"></a>00333                 <span class="keywordflow">break</span>;
<a name="l00334"></a>00334         }
<a name="l00335"></a>00335         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6fbb0f7b5202c07b851ac168ec4aa61547">XRV_INVALIDPARAM</a>;
<a name="l00336"></a>00336 }
<a name="l00337"></a>00337 
<a name="l00339"></a>00339 <span class="comment">// Set the default timeout value to use in blocking operations.</span>
<a name="l00340"></a><a class="code" href="classxsens_1_1_cmt2s.html#80c5349c0813dc5c21b28662a72e714c">00340</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#80c5349c0813dc5c21b28662a72e714c">Cmt2s::setTimeout</a> (<span class="keyword">const</span> uint32_t ms)
<a name="l00341"></a>00341 {
<a name="l00342"></a>00342         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: Setting timeout to %u ms\n"</span>,ms);
<a name="l00343"></a>00343         <span class="keywordflow">if</span> ((<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#d54dc31ac6d752df1a0a6df736200860">setTimeout</a>(ms/2)) != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00344"></a>00344                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>;            <span class="comment">// this can't actually happen</span>
<a name="l00345"></a>00345         <a class="code" href="classxsens_1_1_cmt2s.html#3068c5bc4fd712faef8e219633388943">m_timeout</a> = ms;
<a name="l00346"></a>00346         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 0;
<a name="l00347"></a>00347         <span class="keywordflow">return</span> (<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>);
<a name="l00348"></a>00348 }
<a name="l00349"></a>00349 
<a name="l00351"></a>00351 <span class="comment">// Wait for a message to arrive.</span>
<a name="l00352"></a><a class="code" href="classxsens_1_1_cmt2s.html#d2678d6836924313a6db0b861818536c">00352</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#d2678d6836924313a6db0b861818536c">Cmt2s::waitForMessage</a>(<a class="code" href="classxsens_1_1_message.html">Message</a>* rcv, <span class="keyword">const</span> uint8_t msgId, uint32_t timeoutOverride, <span class="keywordtype">bool</span> acceptErrorMessage)
<a name="l00353"></a>00353 {
<a name="l00354"></a>00354         <a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>* hdr = (<a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>*) <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>;
<a name="l00355"></a>00355         uint16_t pre = 0;
<a name="l00356"></a>00356         uint32_t length = 0;
<a name="l00357"></a>00357         uint32_t target;
<a name="l00358"></a>00358         uint16_t i;
<a name="l00359"></a>00359         <span class="keywordtype">bool</span> extended;
<a name="l00360"></a>00360         <span class="keywordtype">bool</span> readsome = (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &gt; 0);
<a name="l00361"></a>00361         uint32_t toRestore = <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a>;
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage x%02x, TO=%u, TOend=%u, TOO=%u\n"</span>,(uint32_t) msgId, <a class="code" href="classxsens_1_1_cmt2s.html#3068c5bc4fd712faef8e219633388943">m_timeout</a>, <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a>, timeoutOverride);
<a name="l00364"></a>00364 
<a name="l00365"></a>00365         <span class="comment">// The end-time may be misinterpreted around midnight, where it may be considered</span>
<a name="l00366"></a>00366         <span class="comment">// expired even if this is not the case. However, this is extremely rare.</span>
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> == 0)
<a name="l00368"></a>00368         {
<a name="l00369"></a>00369                 <span class="keywordflow">if</span> (timeoutOverride != 0)
<a name="l00370"></a>00370                         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = (<a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>() + (uint32_t) timeoutOverride) % (<a class="code" href="xsens__time_8h.html#7aac032491e970266165e373aebadf65">XSENS_MS_PER_DAY</a>);
<a name="l00371"></a>00371                 <span class="keywordflow">else</span>
<a name="l00372"></a>00372                         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = (<a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>() + (uint32_t) <a class="code" href="classxsens_1_1_cmt2s.html#3068c5bc4fd712faef8e219633388943">m_timeout</a>) % (<a class="code" href="xsens__time_8h.html#7aac032491e970266165e373aebadf65">XSENS_MS_PER_DAY</a>);
<a name="l00373"></a>00373                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> == 0)
<a name="l00374"></a>00374                         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = 1;
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376 
<a name="l00377"></a>00377         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> == 0)
<a name="l00378"></a>00378                 <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[0] = (uint8_t) ~<a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>;      <span class="comment">// create a value that is definitely NOT a preamble</span>
<a name="l00379"></a>00379 
<a name="l00380"></a>00380         <span class="keywordflow">do</span> {
<a name="l00381"></a>00381                 <span class="comment">// find preamble</span>
<a name="l00382"></a>00382                 <span class="keywordflow">while</span> (<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[pre] != <a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>)
<a name="l00383"></a>00383                 {
<a name="l00384"></a>00384                         <span class="keywordflow">if</span> ((++pre) &gt;= <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>)
<a name="l00385"></a>00385                         {
<a name="l00386"></a>00386                                 <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> = 0;
<a name="l00387"></a>00387                                 pre = 0;
<a name="l00388"></a>00388                                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &gt;= <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>())
<a name="l00389"></a>00389                                 {
<a name="l00390"></a>00390                                         <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#2237eef35fbf249e18fa3e50474bf8ea">readData</a>(<a class="code" href="_c_m_tdef_8h.html#f0acc5c2ac066482cc21fcf15d140e22">CMT_LEN_MSGHEADER</a>,<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,&amp;length);
<a name="l00391"></a>00391                                         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> = (uint16_t) length;
<a name="l00392"></a>00392                                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &gt; 0)
<a name="l00393"></a>00393                                                 readsome = <span class="keyword">true</span>;
<a name="l00394"></a>00394                                 }
<a name="l00395"></a>00395                         }
<a name="l00396"></a>00396                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &lt; <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>())
<a name="l00397"></a>00397                                 <span class="keywordflow">break</span>;
<a name="l00398"></a>00398                 }
<a name="l00399"></a>00399                 <span class="comment">// shift buffer to start</span>
<a name="l00400"></a>00400                 <span class="keywordflow">if</span> (pre)
<a name="l00401"></a>00401                 {
<a name="l00402"></a>00402                         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> -= pre;
<a name="l00403"></a>00403                         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>;++i)
<a name="l00404"></a>00404                         {
<a name="l00405"></a>00405                                 <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i] = <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i+pre];
<a name="l00406"></a>00406                         }
<a name="l00407"></a>00407                 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409                 pre = 1;        <span class="comment">// make sure we skip the first item in the next iteration</span>
<a name="l00410"></a>00410                 <span class="comment">// read header</span>
<a name="l00411"></a>00411                 <span class="keywordflow">while</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a> &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &gt;= <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00412"></a>00412                 {
<a name="l00413"></a>00413                         <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#2237eef35fbf249e18fa3e50474bf8ea">readData</a>(<a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a> - <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,&amp;<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>],&amp;length);
<a name="l00414"></a>00414                         m_readBufferCount += (uint16_t) length;
<a name="l00415"></a>00415                 }
<a name="l00416"></a>00416                 <span class="keywordflow">if</span> ((<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>) &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &lt; <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00417"></a>00417                 {
<a name="l00418"></a>00418                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage timeout occurred trying to read header\n"</span>);
<a name="l00419"></a>00419                         <span class="keywordflow">break</span>;
<a name="l00420"></a>00420                 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                 <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> == <a class="code" href="_c_m_tdef_8h.html#d973d7444627ebeb906205cacbcf6f3e">CMT_EXTLENCODE</a>)
<a name="l00423"></a>00423                 {
<a name="l00424"></a>00424                         extended = <span class="keyword">true</span>;
<a name="l00425"></a>00425                         <span class="keywordflow">while</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a> &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &gt;= <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00426"></a>00426                         {
<a name="l00427"></a>00427                                 <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#2237eef35fbf249e18fa3e50474bf8ea">readData</a>(<a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a> - <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,&amp;<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>],&amp;length);
<a name="l00428"></a>00428                                 m_readBufferCount += (uint16_t) length;
<a name="l00429"></a>00429                         }
<a name="l00430"></a>00430                         <span class="keywordflow">if</span> ((<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>) &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &lt; <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00431"></a>00431                         {
<a name="l00432"></a>00432                                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage timeout occurred trying to read extended header\n"</span>);
<a name="l00433"></a>00433                                 <span class="keywordflow">break</span>;
<a name="l00434"></a>00434                         }
<a name="l00435"></a>00435                 }
<a name="l00436"></a>00436                 <span class="keywordflow">else</span>
<a name="l00437"></a>00437                         extended = <span class="keyword">false</span>;
<a name="l00438"></a>00438 
<a name="l00439"></a>00439                 <span class="comment">// check the reported size</span>
<a name="l00440"></a>00440                 <span class="keywordflow">if</span> (extended &amp;&amp; (((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>) &gt; (uint16_t) <a class="code" href="_c_m_tdef_8h.html#b5b89ed4f29d3d51111ac9521dfd9809">CMT_MAXDATALEN</a>))
<a name="l00441"></a>00441                         <span class="keywordflow">continue</span>;
<a name="l00442"></a>00442 
<a name="l00443"></a>00443                 <span class="comment">// header seems to be ok, read until end and check checksum</span>
<a name="l00444"></a>00444                 <span class="keywordflow">if</span> (extended)
<a name="l00445"></a>00445                         target = ((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>) + <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>;
<a name="l00446"></a>00446                 <span class="keywordflow">else</span>
<a name="l00447"></a>00447                         target = hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> + <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>;
<a name="l00448"></a>00448 
<a name="l00449"></a>00449                 <span class="comment">// read the entire message</span>
<a name="l00450"></a>00450                 <span class="keywordflow">while</span> ((<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; target) &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &gt;= <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00451"></a>00451                 {
<a name="l00452"></a>00452                         <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#2237eef35fbf249e18fa3e50474bf8ea">readData</a>(target - <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>,&amp;<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>],&amp;length);
<a name="l00453"></a>00453                         m_readBufferCount += (uint16_t) length;
<a name="l00454"></a>00454                 }
<a name="l00455"></a>00455                 <span class="keywordflow">if</span> ((<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> &lt; target) &amp;&amp; (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &lt; <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>()))
<a name="l00456"></a>00456                 {
<a name="l00457"></a>00457                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage timeout occurred\n"</span>);
<a name="l00458"></a>00458                         <span class="keywordflow">break</span>;
<a name="l00459"></a>00459                 }
<a name="l00460"></a>00460 
<a name="l00461"></a>00461                 <span class="comment">// check the checksum</span>
<a name="l00462"></a>00462                 <span class="comment">//msg=new Message(m_readBuffer,(uint16_t) target, (uint16_t) target);</span>
<a name="l00463"></a>00463                 <span class="keywordflow">if</span> (rcv-&gt;<a class="code" href="classxsens_1_1_message.html#e31a715b5812028284e8fa4a87e987ab">loadFromString</a>(<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,(uint16_t) target) == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00464"></a>00464                 {
<a name="l00465"></a>00465                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage received msg Id x%02x while expecting x%02x, msg size=%u\n"</span>,(uint32_t) rcv-&gt;<a class="code" href="classxsens_1_1_message.html#2858b866e804d9881d331878c3f9a242">getMessageId</a>(),(uint32_t) msgId,target);
<a name="l00466"></a>00466                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#3f397fc880ea2c1c7e0c6cd5d5de111d">m_onMessageReceived</a> != NULL)
<a name="l00467"></a>00467                         {
<a name="l00468"></a>00468                                 <a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>* bytes = (<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>));
<a name="l00469"></a>00469                                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a> = target;
<a name="l00470"></a>00470                                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>();
<a name="l00471"></a>00471 <span class="comment">//                              bytes-&gt;m_type = CMT_CALLBACK_ONMESSAGERECEIVED;</span>
<a name="l00472"></a>00472                                 memcpy(bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#486cf709c2db8534c6e29234fc263d11">m_data</a>,<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,target);
<a name="l00473"></a>00473 <span class="preprocessor">#ifdef _LOG_CALLBACKS</span>
<a name="l00474"></a>00474 <span class="preprocessor"></span>                                <a class="code" href="_c_m_t1_8h.html#990d19ec2de73091adbb95d7057f21a2">CMTLOG</a>(<span class="stringliteral">"C2: m_onMessageReceived(%d,(%d,%d),%p)\n"</span>,(int32_t) <a class="code" href="classxsens_1_1_cmt2s.html#55d1a74bd3941f8f4e8244dd3330eaef">m_onMessageReceivedInstance</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a>, <a class="code" href="classxsens_1_1_cmt2s.html#53a76a499df2fe939163a911ac807c36">m_onMessageReceivedParam</a>);
<a name="l00475"></a>00475 <span class="preprocessor">#endif</span>
<a name="l00476"></a>00476 <span class="preprocessor"></span>                                <a class="code" href="classxsens_1_1_cmt2s.html#3f397fc880ea2c1c7e0c6cd5d5de111d">m_onMessageReceived</a>(m_onMessageReceivedInstance,<a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6bc19200e40f05c942aee06dcd5f45d0d2">CMT_CALLBACK_ONMESSAGERECEIVED</a>,bytes,<a class="code" href="classxsens_1_1_cmt2s.html#53a76a499df2fe939163a911ac807c36">m_onMessageReceivedParam</a>);
<a name="l00477"></a>00477                         }
<a name="l00478"></a>00478 
<a name="l00479"></a>00479                         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> -= (uint16_t) target;
<a name="l00480"></a>00480                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>)
<a name="l00481"></a>00481                         {
<a name="l00482"></a>00482                                 <span class="keywordflow">for</span> (i=0;i&lt;m_readBufferCount;++i)
<a name="l00483"></a>00483                                 {
<a name="l00484"></a>00484                                         <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i] = <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i+target];
<a name="l00485"></a>00485                                 }
<a name="l00486"></a>00486                         }
<a name="l00487"></a>00487 
<a name="l00488"></a>00488                         <span class="keywordflow">if</span> ((msgId == 0) || (msgId == rcv-&gt;<a class="code" href="classxsens_1_1_message.html#2858b866e804d9881d331878c3f9a242">getMessageId</a>()) || (acceptErrorMessage &amp;&amp; rcv-&gt;<a class="code" href="classxsens_1_1_message.html#2858b866e804d9881d331878c3f9a242">getMessageId</a>() == <a class="code" href="_c_m_tdef_8h.html#20edfae402f8a66120cecf43b7983fae">CMT_MID_ERROR</a>))
<a name="l00489"></a>00489                         {
<a name="l00490"></a>00490                                 <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = toRestore;
<a name="l00491"></a>00491                                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00492"></a>00492                         }
<a name="l00493"></a>00493                 }
<a name="l00494"></a>00494                 <span class="keywordflow">else</span>
<a name="l00495"></a>00495                 {
<a name="l00496"></a>00496                         rcv-&gt;<a class="code" href="classxsens_1_1_message.html#8f4333f50bb8a1b4989f8179025c6e8f">clear</a>();
<a name="l00497"></a>00497                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage load from string failed\n"</span>);
<a name="l00498"></a>00498                 }
<a name="l00499"></a>00499         } <span class="keywordflow">while</span> (<a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> &gt;= <a class="code" href="namespacexsens.html#00d5dce92611428c34961bee5893155f">getTimeOfDay</a>());
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="comment">// a timeout occurred</span>
<a name="l00502"></a>00502         <span class="keywordflow">if</span> (readsome)
<a name="l00503"></a>00503         {
<a name="l00504"></a>00504                 <span class="comment">// check if the current data contains a valid message</span>
<a name="l00505"></a>00505                 int32_t pos = <a class="code" href="namespacexsens.html#4afd105a52b808febde0c645742b1d0d">findValidMessage</a>(<a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>,<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507                 <span class="keywordflow">if</span> (pos != -1)
<a name="l00508"></a>00508                 {
<a name="l00509"></a>00509                         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: waitForMessage found message in message\n"</span>);
<a name="l00510"></a>00510                         <span class="comment">// shift data to start of buffer</span>
<a name="l00511"></a>00511                         pre = (uint16_t) pos;
<a name="l00512"></a>00512                         <a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a> -= pre;
<a name="l00513"></a>00513                         <span class="keywordflow">for</span> (i=0;i&lt;<a class="code" href="classxsens_1_1_cmt2s.html#fd3d5a87b16c88bdaca52e0ee4a423ad">m_readBufferCount</a>;++i)
<a name="l00514"></a>00514                         {
<a name="l00515"></a>00515                                 <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i] = <a class="code" href="classxsens_1_1_cmt2s.html#cfd8b33fbd51b4b668cd4eb55ba440e9">m_readBuffer</a>[i+pre];
<a name="l00516"></a>00516                         }
<a name="l00517"></a>00517                         <a class="code" href="classxsens_1_1_cmt2s.html#d2678d6836924313a6db0b861818536c">waitForMessage</a>(rcv,msgId,0,acceptErrorMessage); <span class="comment">// parse the message</span>
<a name="l00518"></a>00518                         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = toRestore;
<a name="l00519"></a>00519                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>;    <span class="comment">// set by waitForMessage</span>
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521 
<a name="l00522"></a>00522                 <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f936b9b026d2756f421ca552f7ec42228">XRV_TIMEOUT</a>;
<a name="l00523"></a>00523         }
<a name="l00524"></a>00524         <span class="keywordflow">else</span>
<a name="l00525"></a>00525                 <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6ff6f3fafb23eaadc2967be9268677e981">XRV_TIMEOUTNODATA</a>;
<a name="l00526"></a>00526         <a class="code" href="classxsens_1_1_cmt2s.html#6330e23b00c4b2deb4149581ddb92d25">m_toEnd</a> = toRestore;
<a name="l00527"></a>00527         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>;
<a name="l00528"></a>00528 }
<a name="l00529"></a>00529 
<a name="l00531"></a>00531 <span class="comment">// Send a message over the COM port.</span>
<a name="l00532"></a><a class="code" href="classxsens_1_1_cmt2s.html#0cd65c8ae8f214e65cdca6c8aceb262c">00532</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2s.html#0cd65c8ae8f214e65cdca6c8aceb262c">Cmt2s::writeMessage</a>(<a class="code" href="classxsens_1_1_message.html">Message</a>* msg)
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: writeMessage %2x %2x %2x %2x %2x\n"</span>,(int32_t) msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[0]
<a name="l00535"></a>00535                                                                                                         ,(int32_t) msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[1]
<a name="l00536"></a>00536                                                                                                         ,(int32_t) msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[2]
<a name="l00537"></a>00537                                                                                                         ,(int32_t) msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[3]
<a name="l00538"></a>00538                                                                                                         ,(int32_t) msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>()[4]);
<a name="l00539"></a>00539         uint32_t written = 0;
<a name="l00540"></a>00540         <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = 
<a name="l00541"></a>00541                         <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#733fc297e7c1d7639f60a7e6bc5ce3bd">writeData</a>(msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>(),msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>(),&amp;written);
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00544"></a>00544         {
<a name="l00545"></a>00545                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: writeMessage returns %d: %s\n"</span>,(int32_t) <a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a>, <a class="code" href="xsens__std_8h.html#7386853937f4c078e1458f2c34049ace">xsensResultText</a>(m_lastResult));
<a name="l00546"></a>00546                 <span class="keywordflow">return</span> m_lastResult;
<a name="l00547"></a>00547         }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549         <span class="keywordflow">if</span> (written != msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>())
<a name="l00550"></a>00550         {
<a name="l00551"></a>00551                 <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: writeMessage wrote %u of %u bytes, returns %d: %s\n"</span>,written,msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>(),(int32_t) <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>, <a class="code" href="xsens__std_8h.html#7386853937f4c078e1458f2c34049ace">xsensResultText</a>(<a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>));
<a name="l00552"></a>00552                 <span class="keywordflow">return</span> (<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f8b48357051e4a998c816b2ca8479f9f8">XRV_ERROR</a>);
<a name="l00553"></a>00553         }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2s.html#8f6fdf451d367d9f84b43b43ad654a71">m_onMessageSent</a> != NULL)
<a name="l00556"></a>00556         {
<a name="l00557"></a>00557                 <a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>* bytes = (<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>*) malloc(<span class="keyword">sizeof</span>(<a class="code" href="struct_cmt_binary_data.html">CmtBinaryData</a>));
<a name="l00558"></a>00558                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a> = msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>();
<a name="l00559"></a>00559                 bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a> = <a class="code" href="classxsens_1_1_cmt2s.html#825a3557e45cdd635c2d1f68fda197ff">m_cmt1s</a>.<a class="code" href="classxsens_1_1_cmt1s.html#e00b8e70bae432cfc149c83a7cc24887">getPortNr</a>();
<a name="l00560"></a>00560                 memcpy(bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#486cf709c2db8534c6e29234fc263d11">m_data</a>,msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>(),msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>());
<a name="l00561"></a>00561 <span class="preprocessor">#ifdef _LOG_CALLBACKS</span>
<a name="l00562"></a>00562 <span class="preprocessor"></span>                <a class="code" href="_c_m_t1_8h.html#990d19ec2de73091adbb95d7057f21a2">CMTLOG</a>(<span class="stringliteral">"C2: m_onMessageSent(%d,(%d,%d),%p)\n"</span>,(int32_t) <a class="code" href="classxsens_1_1_cmt2s.html#cadf278c15be513e435d8eb69777c4d8">m_onMessageSentInstance</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#102c548cd4fe3f51391e39400e556dc6">m_size</a>, (int32_t) bytes-&gt;<a class="code" href="struct_cmt_binary_data.html#5fadd9338e185406c2dfe83a6eccfdc6">m_portNr</a>, <a class="code" href="classxsens_1_1_cmt2s.html#cbce34e1a0a099773bb41dd920ead345">m_onMessageSentParam</a>);
<a name="l00563"></a>00563 <span class="preprocessor">#endif</span>
<a name="l00564"></a>00564 <span class="preprocessor"></span>                <a class="code" href="classxsens_1_1_cmt2s.html#8f6fdf451d367d9f84b43b43ad654a71">m_onMessageSent</a>(m_onMessageSentInstance,<a class="code" href="_c_m_tdef_8h.html#cd5beee6c9d90ee2027b5ed87587aa6b4c20d96cde6cb06b75533c9ff3028afc">CMT_CALLBACK_ONMESSAGESENT</a>,bytes,<a class="code" href="classxsens_1_1_cmt2s.html#cbce34e1a0a099773bb41dd920ead345">m_onMessageSentParam</a>);
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         <a class="code" href="_c_m_t2_8cpp.html#fb4cc478601e76b32e94ae8d0c031545">CMT2LOG</a>(<span class="stringliteral">"L2: writeMessage successful\n"</span>);
<a name="l00568"></a>00568         <span class="keywordflow">return</span> (<a class="code" href="classxsens_1_1_cmt2s.html#bacfa56aa9ba72212e29817c52aa143b">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>);
<a name="l00569"></a>00569 }
<a name="l00570"></a>00570         
<a name="l00574"></a>00574 
<a name="l00576"></a>00576 <span class="comment">// Default constructor</span>
<a name="l00577"></a><a class="code" href="classxsens_1_1_cmt2f.html#90560cd7201013b5d891ec589e05df6e">00577</a> <a class="code" href="classxsens_1_1_cmt2f.html#90560cd7201013b5d891ec589e05df6e">Cmt2f::Cmt2f</a>()
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00580"></a>00580         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = <span class="keyword">true</span>;
<a name="l00581"></a>00581 }
<a name="l00582"></a>00582 
<a name="l00584"></a>00584 <span class="comment">// Destructor.</span>
<a name="l00585"></a><a class="code" href="classxsens_1_1_cmt2f.html#2dbf1f3cbff23f7d9ff091a12eef1eec">00585</a> <a class="code" href="classxsens_1_1_cmt2f.html#2dbf1f3cbff23f7d9ff091a12eef1eec">Cmt2f::~Cmt2f</a>()
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587         <a class="code" href="classxsens_1_1_cmt2f.html#4aef4b12a2764c6f1022a43e48100040">close</a>();
<a name="l00588"></a>00588 }
<a name="l00589"></a>00589 
<a name="l00591"></a>00591 <span class="comment">// Close the file.</span>
<a name="l00592"></a><a class="code" href="classxsens_1_1_cmt2f.html#4aef4b12a2764c6f1022a43e48100040">00592</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#4aef4b12a2764c6f1022a43e48100040">Cmt2f::close</a>(<span class="keywordtype">void</span>)
<a name="l00593"></a>00593 {
<a name="l00594"></a>00594         <span class="keywordflow">if</span> (!<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00595"></a>00595                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f4f6804db86d07ebd213960d10ff6eb62">XRV_NOFILEOPEN</a>;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597         <span class="comment">// save any unsaved data</span>
<a name="l00598"></a>00598         <span class="comment">// close the file</span>
<a name="l00599"></a>00599         <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#998f005fb3832d4945e53a41b570d634">close</a>();
<a name="l00600"></a>00600         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = <span class="keyword">true</span>;
<a name="l00601"></a>00601         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00605"></a>00605 <span class="comment">// Close the file and delete it.</span>
<a name="l00606"></a><a class="code" href="classxsens_1_1_cmt2f.html#59b667c6fb15792d45f207ddbee02caf">00606</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#59b667c6fb15792d45f207ddbee02caf">Cmt2f::closeAndDelete</a>(<span class="keywordtype">void</span>)
<a name="l00607"></a>00607 {
<a name="l00608"></a>00608         <span class="keywordflow">if</span> (!<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00609"></a>00609                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f4f6804db86d07ebd213960d10ff6eb62">XRV_NOFILEOPEN</a>;
<a name="l00610"></a>00610 
<a name="l00611"></a>00611         <span class="comment">// close the file</span>
<a name="l00612"></a>00612         <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#7f88bf518daead18acd478c53874f59e">closeAndDelete</a>();
<a name="l00613"></a>00613         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = <span class="keyword">true</span>;
<a name="l00614"></a>00614         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00615"></a>00615 }
<a name="l00616"></a>00616 
<a name="l00618"></a>00618 <span class="comment">// Create a new file with level 2 header</span>
<a name="l00619"></a><a class="code" href="classxsens_1_1_cmt2f.html#5c4844e3bcf4bb897e902bf4caa7659c">00619</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#5c4844e3bcf4bb897e902bf4caa7659c">Cmt2f::create</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename)
<a name="l00620"></a>00620 {
<a name="l00621"></a>00621         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00622"></a>00622                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f16ebfc281a5629d2ace0945e742e2a14">XRV_ALREADYOPEN</a>;
<a name="l00623"></a>00623 
<a name="l00624"></a>00624         <span class="comment">// create file</span>
<a name="l00625"></a>00625         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#fe9e7fd93967527fcabfdc0e248f9acc">create</a>(filename);
<a name="l00626"></a>00626         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00627"></a>00627                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = <span class="keyword">false</span>;
<a name="l00630"></a>00630 
<a name="l00631"></a>00631         <span class="comment">// check if we can actually write to the file</span>
<a name="l00632"></a>00632         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#a62d96ccce3c8e407d20bd0346d94991">writeData</a>(5,<span class="stringliteral">"Xsens"</span>);
<a name="l00633"></a>00633         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00634"></a>00634                 <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#5985fee07884566dfe00b1be99b39079">deleteData</a>(0,5);
<a name="l00635"></a>00635         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00636"></a>00636                 <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#998f005fb3832d4945e53a41b570d634">close</a>();
<a name="l00637"></a>00637         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00638"></a>00638 }
<a name="l00639"></a>00639 
<a name="l00641"></a>00641 <span class="comment">// Create a new file with level 2 header</span>
<a name="l00642"></a><a class="code" href="classxsens_1_1_cmt2f.html#182ff3dc4af83a61907468422e5c6c36">00642</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#5c4844e3bcf4bb897e902bf4caa7659c">Cmt2f::create</a>(<span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* filename)
<a name="l00643"></a>00643 {
<a name="l00644"></a>00644         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00645"></a>00645                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f16ebfc281a5629d2ace0945e742e2a14">XRV_ALREADYOPEN</a>;
<a name="l00646"></a>00646 
<a name="l00647"></a>00647         <span class="comment">// create file</span>
<a name="l00648"></a>00648         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#fe9e7fd93967527fcabfdc0e248f9acc">create</a>(filename);
<a name="l00649"></a>00649         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00650"></a>00650                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00651"></a>00651 
<a name="l00652"></a>00652         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = <span class="keyword">false</span>;
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="comment">// check if we can actually write to the file</span>
<a name="l00655"></a>00655         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#a62d96ccce3c8e407d20bd0346d94991">writeData</a>(5,<span class="stringliteral">"Xsens"</span>);
<a name="l00656"></a>00656         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00657"></a>00657                 <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#5985fee07884566dfe00b1be99b39079">deleteData</a>(0,5);
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00659"></a>00659                 <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#998f005fb3832d4945e53a41b570d634">close</a>();
<a name="l00660"></a>00660         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00664"></a><a class="code" href="classxsens_1_1_cmt2f.html#4b910349b4100ee98e079988d71a0559">00664</a> <a class="code" href="classxsens_1_1_cmt1f.html">Cmt1f</a>* <a class="code" href="classxsens_1_1_cmt2f.html#4b910349b4100ee98e079988d71a0559">Cmt2f::getCmt1f</a>(<span class="keywordtype">void</span>)
<a name="l00665"></a>00665 {
<a name="l00666"></a>00666         <span class="keywordflow">return</span> &amp;<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>;
<a name="l00667"></a>00667 }
<a name="l00668"></a>00668 
<a name="l00670"></a>00670 <span class="comment">// Return the error code of the last operation.</span>
<a name="l00671"></a><a class="code" href="classxsens_1_1_cmt2f.html#fe0ac149d99848609f3ff7ee9b7890c0">00671</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#fe0ac149d99848609f3ff7ee9b7890c0">Cmt2f::getLastResult</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00672"></a>00672 <span class="keyword"></span>{
<a name="l00673"></a>00673         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00674"></a>00674 }
<a name="l00675"></a>00675 
<a name="l00677"></a>00677 <span class="comment">// Retrieve the filename that was last successfully opened.</span>
<a name="l00678"></a><a class="code" href="classxsens_1_1_cmt2f.html#01a9f99cc134707db1b493bfa0eb9f21">00678</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#01a9f99cc134707db1b493bfa0eb9f21">Cmt2f::getName</a>(<span class="keywordtype">char</span>* filename)<span class="keyword"> const</span>
<a name="l00679"></a>00679 <span class="keyword"></span>{
<a name="l00680"></a>00680         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#1447858cb01e173d8ee02f45e39a39f2">getName</a>(filename);
<a name="l00681"></a>00681 }
<a name="l00682"></a>00682 
<a name="l00684"></a>00684 <span class="comment">// Retrieve the filename that was last successfully opened.</span>
<a name="l00685"></a><a class="code" href="classxsens_1_1_cmt2f.html#724e72138fbe29cc20eff1d7f9d6183f">00685</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#01a9f99cc134707db1b493bfa0eb9f21">Cmt2f::getName</a>(<span class="keywordtype">wchar_t</span>* filename)<span class="keyword"> const</span>
<a name="l00686"></a>00686 <span class="keyword"></span>{
<a name="l00687"></a>00687         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#1447858cb01e173d8ee02f45e39a39f2">getName</a>(filename);
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00691"></a>00691 <span class="comment">// Return whether the file is open or not.</span>
<a name="l00692"></a><a class="code" href="classxsens_1_1_cmt2f.html#5435b3fa06f7afde8e6cc58d4195d005">00692</a> <span class="keywordtype">bool</span> <a class="code" href="classxsens_1_1_cmt2f.html#5435b3fa06f7afde8e6cc58d4195d005">Cmt2f::isOpen</a>(<span class="keywordtype">void</span>)<span class="keyword"> const</span>
<a name="l00693"></a>00693 <span class="keyword"></span>{
<a name="l00694"></a>00694         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>();
<a name="l00695"></a>00695 }
<a name="l00696"></a>00696 
<a name="l00698"></a>00698 <span class="comment">// Open a file and read the header</span>
<a name="l00699"></a><a class="code" href="classxsens_1_1_cmt2f.html#ea0ba51bd0aa1e97ef181bc501401658">00699</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#ea0ba51bd0aa1e97ef181bc501401658">Cmt2f::open</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* filename, <span class="keyword">const</span> <span class="keywordtype">bool</span> readOnly)
<a name="l00700"></a>00700 {
<a name="l00701"></a>00701         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00702"></a>00702                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f16ebfc281a5629d2ace0945e742e2a14">XRV_ALREADYOPEN</a>;
<a name="l00703"></a>00703         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#c3623b1bd3ab4aa7aaa1cdfe494494d7">open</a>(filename,!readOnly,readOnly);
<a name="l00704"></a>00704         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = readOnly;
<a name="l00705"></a>00705         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00706"></a>00706 }
<a name="l00707"></a>00707 
<a name="l00709"></a>00709 <span class="comment">// Open a file and read the header</span>
<a name="l00710"></a><a class="code" href="classxsens_1_1_cmt2f.html#c03c77dfad74a8b69da1b8473d4ff56c">00710</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#ea0ba51bd0aa1e97ef181bc501401658">Cmt2f::open</a>(<span class="keyword">const</span> <span class="keywordtype">wchar_t</span>* filename, <span class="keyword">const</span> <span class="keywordtype">bool</span> readOnly)
<a name="l00711"></a>00711 {
<a name="l00712"></a>00712         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#2068defb2740556214948f20b23e602c">isOpen</a>())
<a name="l00713"></a>00713                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f16ebfc281a5629d2ace0945e742e2a14">XRV_ALREADYOPEN</a>;
<a name="l00714"></a>00714         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#c3623b1bd3ab4aa7aaa1cdfe494494d7">open</a>(filename,!readOnly,readOnly);
<a name="l00715"></a>00715         <a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a> = readOnly;
<a name="l00716"></a>00716         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00720"></a>00720 <span class="comment">// Read the next message from the file</span>
<a name="l00721"></a><a class="code" href="classxsens_1_1_cmt2f.html#1d3dcc7a6b8da8f619fa1713606cdda2">00721</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#1d3dcc7a6b8da8f619fa1713606cdda2">Cmt2f::readMessage</a>(<a class="code" href="classxsens_1_1_message.html">Message</a>* msg, <span class="keyword">const</span> uint8_t msgId)
<a name="l00722"></a>00722 {
<a name="l00723"></a>00723         <a class="code" href="_c_m_tf_8h.html#dbed9c7a0b58f20448127d9e869075a8">CmtFilePos</a> pos;
<a name="l00724"></a>00724         uint8_t needle = <a class="code" href="_c_m_tdef_8h.html#c5fa524d72f02f4d7618b09b9caed20b">CMT_PREAMBLE</a>;
<a name="l00725"></a>00725         uint8_t buffer[<a class="code" href="_c_m_tdef_8h.html#e839e2b84cd613ca5483c7c58b759d6f">CMT_MAXMSGLEN</a>];
<a name="l00726"></a>00726         uint32_t length, bcount;
<a name="l00727"></a>00727         <a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>* hdr = (<a class="code" href="structxsens_1_1_message_header.html">MessageHeader</a>*) buffer;
<a name="l00728"></a>00728         <span class="keywordtype">bool</span> extended;
<a name="l00729"></a>00729         uint16_t target;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         <span class="keywordflow">while</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00732"></a>00732         {
<a name="l00733"></a>00733                 bcount = 0;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735                 <span class="comment">// find a message preamble</span>
<a name="l00736"></a>00736                 <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#ca188517973dc3c208cd56c885776ada">find</a>(&amp;needle,1,pos);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00739"></a>00739                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00740"></a>00740 
<a name="l00741"></a>00741                 <span class="comment">// read header</span>
<a name="l00742"></a>00742                 <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#d5850430ffa0988986c0b10d218023a2">readData</a>(<a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>,buffer,&amp;length);
<a name="l00743"></a>00743                 bcount += length;
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00745"></a>00745                         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00746"></a>00746 
<a name="l00747"></a>00747                 <span class="keywordflow">if</span> (hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> == <a class="code" href="_c_m_tdef_8h.html#d973d7444627ebeb906205cacbcf6f3e">CMT_EXTLENCODE</a>)
<a name="l00748"></a>00748                 {
<a name="l00749"></a>00749                         extended = <span class="keyword">true</span>;
<a name="l00750"></a>00750                         <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#d5850430ffa0988986c0b10d218023a2">readData</a>(<a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a> - bcount,&amp;buffer[bcount],&amp;length);
<a name="l00751"></a>00751                         bcount += length;
<a name="l00752"></a>00752                         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00753"></a>00753                         {
<a name="l00754"></a>00754                                 <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#24f2ef6020512a4a430775413dda24f4">setReadPos</a>(pos+1);
<a name="l00755"></a>00755                                 <span class="keywordflow">continue</span>;
<a name="l00756"></a>00756                         }
<a name="l00757"></a>00757                 }
<a name="l00758"></a>00758                 <span class="keywordflow">else</span>
<a name="l00759"></a>00759                         extended = <span class="keyword">false</span>;
<a name="l00760"></a>00760 
<a name="l00761"></a>00761                 <span class="comment">// check the reported size</span>
<a name="l00762"></a>00762                 <span class="keywordflow">if</span> (extended &amp;&amp; (((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>) &gt; (uint16_t) <a class="code" href="_c_m_tdef_8h.html#b5b89ed4f29d3d51111ac9521dfd9809">CMT_MAXDATALEN</a>))
<a name="l00763"></a>00763                 {
<a name="l00764"></a>00764                         <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#24f2ef6020512a4a430775413dda24f4">setReadPos</a>(pos+1);
<a name="l00765"></a>00765                         <span class="keywordflow">continue</span>;
<a name="l00766"></a>00766                 }
<a name="l00767"></a>00767 
<a name="l00768"></a>00768                 <span class="comment">// header seems to be ok, read until end and check checksum</span>
<a name="l00769"></a>00769                 <span class="keywordflow">if</span> (extended)
<a name="l00770"></a>00770                         target = ((uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#0ee9a5cd466e7a96eb8ca60eee912579">m_high</a> * 256 + (uint16_t) hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#924cf50df941d08350e12161593c106b">m_datlen</a>.<a class="code" href="unionxsens_1_1_message_header_1_1__mdl.html#50dfc2b4f47c04403d08fd7334179b35">m_extended</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd.html#49d8654af78af5736fa9dccbd5445228">m_length</a>.<a class="code" href="structxsens_1_1_message_header_1_1__mdl_1_1__mextd_1_1__mlen.html#d6a8f2ced03454391f7926d9ddaa3f44">m_low</a>) + <a class="code" href="_c_m_tdef_8h.html#eacdf53e01e560fa78557df19a95c49b">CMT_LEN_MSGEXTHEADERCS</a>;
<a name="l00771"></a>00771                 <span class="keywordflow">else</span>
<a name="l00772"></a>00772                         target = hdr-&gt;<a class="code" href="structxsens_1_1_message_header.html#a8999427b4315622ce76e2c22e528f92">m_length</a> + <a class="code" href="_c_m_tdef_8h.html#1094ef666aa12099ee66494890aeff4d">CMT_LEN_MSGHEADERCS</a>;
<a name="l00773"></a>00773 
<a name="l00774"></a>00774                 <span class="comment">// read the entire message</span>
<a name="l00775"></a>00775                 <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#d5850430ffa0988986c0b10d218023a2">readData</a>(target - bcount,&amp;buffer[bcount],&amp;length);
<a name="l00776"></a>00776                 bcount += length;
<a name="l00777"></a>00777                 <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> != <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00778"></a>00778                 {
<a name="l00779"></a>00779                         <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#24f2ef6020512a4a430775413dda24f4">setReadPos</a>(pos+1);
<a name="l00780"></a>00780                         <span class="keywordflow">continue</span>;
<a name="l00781"></a>00781                 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783                 <span class="comment">// check the checksum</span>
<a name="l00784"></a>00784                 <span class="comment">//msg=new Message(m_readBuffer,(uint16_t) target, (uint16_t) target);</span>
<a name="l00785"></a>00785                 <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="classxsens_1_1_message.html#e31a715b5812028284e8fa4a87e987ab">loadFromString</a>(buffer,(uint16_t) target) == <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>)
<a name="l00786"></a>00786                 {
<a name="l00787"></a>00787                         <span class="keywordflow">if</span> ((msgId == 0) || (msgId == msg-&gt;<a class="code" href="classxsens_1_1_message.html#2858b866e804d9881d331878c3f9a242">getMessageId</a>()))
<a name="l00788"></a>00788                                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f9ecc38cf5706b4dc62700e99abc3bc73">XRV_OK</a>;
<a name="l00789"></a>00789                         pos += target-1;
<a name="l00790"></a>00790                 }
<a name="l00791"></a>00791                 msg-&gt;<a class="code" href="classxsens_1_1_message.html#8f4333f50bb8a1b4989f8179025c6e8f">clear</a>();
<a name="l00792"></a>00792                 <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#24f2ef6020512a4a430775413dda24f4">setReadPos</a>(pos+1);
<a name="l00793"></a>00793         }
<a name="l00794"></a>00794         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a>;
<a name="l00795"></a>00795 }
<a name="l00796"></a>00796 
<a name="l00798"></a>00798 <span class="comment">// Get the current file size</span>
<a name="l00799"></a><a class="code" href="classxsens_1_1_cmt2f.html#310168fda31fff68b27de7366ab16833">00799</a> <a class="code" href="_c_m_tf_8h.html#dbed9c7a0b58f20448127d9e869075a8">CmtFilePos</a> <a class="code" href="classxsens_1_1_cmt2f.html#310168fda31fff68b27de7366ab16833">Cmt2f::getFileSize</a>(<span class="keywordtype">void</span>)
<a name="l00800"></a>00800 {
<a name="l00801"></a>00801         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#e33412bf6a83e269e3c0547256f6c96c">getFileSize</a>();
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00805"></a>00805 <span class="comment">// Get the current read position of the file</span>
<a name="l00806"></a><a class="code" href="classxsens_1_1_cmt2f.html#37f6f8c4bdd141414fd239e043a9dee1">00806</a> <a class="code" href="_c_m_tf_8h.html#dbed9c7a0b58f20448127d9e869075a8">CmtFilePos</a> <a class="code" href="classxsens_1_1_cmt2f.html#37f6f8c4bdd141414fd239e043a9dee1">Cmt2f::getReadPosition</a>(<span class="keywordtype">void</span>)
<a name="l00807"></a>00807 {
<a name="l00808"></a>00808         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#5862156ba2d8253efc71ef2def6f1f98">getReadPos</a>();
<a name="l00809"></a>00809 }
<a name="l00810"></a>00810 
<a name="l00812"></a>00812 <span class="comment">// Set the read position to the given position</span>
<a name="l00813"></a><a class="code" href="classxsens_1_1_cmt2f.html#86091275fad9eb56467b0c4ff7997855">00813</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#86091275fad9eb56467b0c4ff7997855">Cmt2f::setReadPosition</a>(<a class="code" href="_c_m_tf_8h.html#dbed9c7a0b58f20448127d9e869075a8">CmtFilePos</a> pos)
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#24f2ef6020512a4a430775413dda24f4">setReadPos</a>(pos);
<a name="l00816"></a>00816 }
<a name="l00817"></a>00817 
<a name="l00819"></a>00819 <span class="comment">// Write a message to the end of the file</span>
<a name="l00820"></a><a class="code" href="classxsens_1_1_cmt2f.html#1c665af24300d003856973621f1786c6">00820</a> <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6f">XsensResultValue</a> <a class="code" href="classxsens_1_1_cmt2f.html#1c665af24300d003856973621f1786c6">Cmt2f::writeMessage</a>(<span class="keyword">const</span> <a class="code" href="classxsens_1_1_message.html">Message</a>* msg)
<a name="l00821"></a>00821 {
<a name="l00822"></a>00822         <span class="keywordflow">if</span> (<a class="code" href="classxsens_1_1_cmt2f.html#0cd0131b94f2a3b8e60739bb06e4e2e3">m_readOnly</a>)
<a name="l00823"></a>00823                 <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="xsens__std_8h.html#822a2260a20af524029eef9e9a51ff6fbe5d6d8e99eeb03058667d828b9fb9f3">XRV_READONLY</a>;
<a name="l00824"></a>00824         <span class="keywordflow">return</span> <a class="code" href="classxsens_1_1_cmt2f.html#3b8efc86964bf8fdfefa522d4ed276a0">m_lastResult</a> = <a class="code" href="classxsens_1_1_cmt2f.html#7eb9f21e2a62c7f04542314fc77e3643">m_cmt1f</a>.<a class="code" href="classxsens_1_1_cmt1f.html#761759c365acf23f7e4159b5bedb1ae4">appendData</a>(msg-&gt;<a class="code" href="classxsens_1_1_message.html#75725a5fd44e7db82fac386f29dd97df">getTotalMessageSize</a>(),msg-&gt;<a class="code" href="classxsens_1_1_message.html#1c062f77b4440c409591b48c953b87d2">getMessageStart</a>());
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 } <span class="comment">// end of xsens namespace</span>
</pre></div>
<div class="tabs">&nbsp;</div>
<hr size="1" />
<address style="text-align: right;">
<small>Generated on 14 Nov 2008 for CMT by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.5.1-p1</small>
</address>
</body>
</html>
