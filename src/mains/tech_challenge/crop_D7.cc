 // ========================================================================
// Program CROP_D7 utilizes ImageMagick's conversion program to crop
// panoramas generated by D7 video cameras down to specified, uniform
// widths and heights measured in pixels.
// ========================================================================
// Last updated on 4/23/10; 7/4/10
// ========================================================================

#include <iostream>
#include <string>

#include "general/filefuncs.h"
#include "image/imagefuncs.h"
#include "general/outputfuncs.h"
#include "general/stringfuncs.h"
#include "general/sysfuncs.h"

using std::cin;
using std::cout;
using std::endl;
using std::ofstream;
using std::string;

// ==========================================================================
int main( int argc, char** argv )
{
   string basefilename="image-";
//   cout << "Enter panorama base filename:" << endl;
//   cin >> basefilename;
  
//   string imagedir="./";
   string imagedir=
      "~/svn/Documents/tech_challenge/field_tests/July2_mast/frames/";
//   cout << "Enter subdir containing panorama PNG images:"<< endl;
//   cin >> imagedir;

   string cropped_basefilename="cropped_"+basefilename;
   string cropped_images_dir=imagedir+"cropped_images/";
   filefunc::dircreate(cropped_images_dir);
   string cropped_panels_dir=cropped_images_dir+"panels/";
   filefunc::dircreate(cropped_panels_dir);

   string suffix=".png";

   int n_start=0;
   cout << "Enter starting image number:" << endl;
   cin >> n_start;
   
   int n_stop=-1;
   cout << "Enter stopping image number:" << endl;
   cin >> n_stop;

// Use GIMP to read off panorama strip's lower left and upper right
// corners measured in pixel coordinates:

   int xstart=55;
   int ystart=310;

   int xstop=1222;
   int ystop=17;
   
   int xoffset=xstart;
   int yoffset=ystop;
   int width=xstop-xstart;
   int height=ystart-ystop;
   
// First cut out 180 degree panorama strip from each input image:

   const int ndigits=5;

   for (int n=n_start; n<= n_stop; n++)
   {
      string panorama_filename=imagedir+basefilename+
         stringfunc::integer_to_string(n,5)+suffix;
      cout << "panorama_filename = " << panorama_filename << endl;

      string cropped_panorama_filename=cropped_images_dir+
         cropped_basefilename+stringfunc::integer_to_string(n,5)+suffix;
      string unix_command="cp "+panorama_filename+" "+
         cropped_panorama_filename;
      sysfunc::unix_command(unix_command);

      cout << "Cropping file = " << cropped_panorama_filename << endl;
      imagefunc::crop_image(
         cropped_panorama_filename,width,height,xoffset,yoffset);

   }
}
